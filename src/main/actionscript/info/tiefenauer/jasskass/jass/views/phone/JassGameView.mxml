<?xml version="1.0" encoding="utf-8"?>
<base:JassGameViewBase xmlns:fx="http://ns.adobe.com/mxml/2009" 
				   xmlns:s="library://ns.adobe.com/flex/spark" 
				   xmlns:base="info.tiefenauer.jasskass.jass.views.base.*"
				   implements="info.tiefenauer.jasskass.jass.views.interfaces.IJassGameView"
				   >
	
	<fx:Script>
		<![CDATA[
			import spark.events.PopUpEvent;
			
			import info.tiefenauer.jasskass.jass.model.interfaces.IJassGame;
			import info.tiefenauer.jasskass.jass.model.interfaces.IWys;
			import info.tiefenauer.jasskass.jass.views.popups.JassSliderPopup;
			import info.tiefenauer.jasskass.jass.views.popups.WysPopup;

			[Bindable] public var team1TotalPoints:Number = 0;
			[Bindable] public var team2TotalPoints:Number = 0;
			
			public var team1Points:Number = 0;
			public var team2Points:Number = 0;
			public var wysTarget:Object;
			public var wyses:Vector.<IWys>;

			//------------------
			// Event handler
			//------------------
			protected function onJassTafelClicked(event:MouseEvent):void{
				var jassSliderPopup:JassSliderPopup = new JassSliderPopup();
				jassSliderPopup.addEventListener(PopUpEvent.CLOSE, function(closeEvent:PopUpEvent):void{
					if (closeEvent.data){
						team1Points = closeEvent.data['team1'];
						team2Points = closeEvent.data['team2'];
						dispatchEvent(new Event(POINTS_ENTERED));
					}
				});
				jassSliderPopup.show();
			}
			protected function wys(event:MouseEvent):void{
				var wysPopup:WysPopup = new WysPopup();
				wysPopup.addEventListener(PopUpEvent.CLOSE, function(closeEvent:PopUpEvent):void{
					if (closeEvent.data){
						wyses = closeEvent.data;
						wysTarget = event.target;
						dispatchEvent(new Event(WYS_ENTERED));
					}
				});
				wysPopup.show();
			}
			protected function stoeck(event:MouseEvent):void{
				wysTarget = event.target;
				dispatchEvent(new Event(STOECK_ENTERED));
			}
			protected function onFlipJassBoardButtonClicked(event:MouseEvent):void{
				dispatchEvent(new Event(FLIP_BOARD_BUTTON_CLICKED));
			}
			
			override public function set game(value:IJassGame):void{
				super.game = value;
				team1TotalPoints = game.team1TotalPoints;
				team2TotalPoints = game.team2TotalPoints;
			}
			
		]]>
	</fx:Script>
	

	<base:layout>
		<s:VerticalLayout />
	</base:layout>
	
	<base:actionContent>
		<s:Button id="flipJassBoard"
				  label="Flipe"
				  click="onFlipJassBoardButtonClicked(event)"
				  />
	</base:actionContent>
	
	<s:HGroup width="100%">
		<s:Button id="wysButtonTeam1"
				  label="Wys"
				  click="wys(event)"
				  width="100%"
				  />
		<s:Button id="stoeckButtonTeam1"
				  label="Stöck"
				  click="stoeck(event)"
				  width="100%"
				  />
	</s:HGroup>
	
	<s:Label id="team1PointsLabel" text="{team1TotalPoints}" top="0" textAlign="center" width="100%" />
	
	<s:Group id="panelGroup" width="100%" height="100%"	 click="onJassTafelClicked(event)"/>
	
	<s:Label id="team2PointsLabel" text="{team2TotalPoints}" bottom="0" textAlign="center" width="100%" />
	
	<s:HGroup width="100%">
		<s:Button id="wysButtonTeam2"
				  label="Wys"
				  click="wys(event)"
				  width="100%"
				  />
		<s:Button id="stoeckButtonTeam2"
				  label="Stöck"
				  click="stoeck(event)"
				  width="100%"
				  />
	</s:HGroup>
	
</base:JassGameViewBase>
